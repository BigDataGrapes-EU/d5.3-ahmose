(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e){e.exports={$schema:"https://vega.github.io/schema/vega/v5.json",autosize:"pad",padding:25,data:[{name:"modelData"},{name:"featuresInfo"},{name:"modelsInfo"},{name:"intervalData"},{name:"data_0",source:"modelData",transform:[{type:"lookup",from:"featuresInfo",key:"feature",fields:["feature"],values:["feature_label"]},{type:"lookup",from:"modelsInfo",key:"model",fields:["model"],values:["model_label"]},{type:"formula",expr:"abs(datum.shap_value)",as:"abs_shap_value"}]},{name:"data_1",source:"data_0",transform:[{type:"lookup",from:"intervalData",key:"label",fields:["label"],values:["x1","x2","y1","y2"]},{type:"joinaggregate",as:["mean_abs_shap_value_by_feature_label"],ops:["mean"],fields:["abs_shap_value"],groupby:["feature_label"]}]},{name:"concat_0_column_domain",source:"data_1",transform:[{type:"aggregate",groupby:["feature_label"],fields:["abs_shap_value"],ops:["mean"],as:["mean_abs_shap_value"]}]},{name:"concat_0_row_domain",source:"data_1",transform:[{type:"aggregate",groupby:["model_label"]}]},{name:"data_3",source:"data_1",transform:[{type:"aggregate",groupby:["label","x2","y2","model_label","feature_label"],ops:["mean","mean"],fields:["x1","y1"],as:["mean_x1","mean_y1"]}]},{name:"data_4",source:"data_0",transform:[{type:"aggregate",groupby:["feature","model_label"],ops:["mean","mean","missing","count"],fields:["abs_shap_value","agree","agree",null],as:["mean_abs_shap_value","mean_agree","missing","total"]},{type:"stack",groupby:["model_label"],field:"mean_abs_shap_value",sort:{field:["mean_abs_shap_value"],order:["descending"]},as:["x1","x2"],offset:"normalize"},{type:"formula",expr:"datum.missing / datum.total",as:"missing_percentage"},{type:"formula",expr:"datum.missing_percentage == 1 ? 0 : datum.mean_agree",as:"mean_agree"},{type:"formula",expr:"[datum.mean_agree * (1 - datum.missing_percentage), (1 - datum.mean_agree) * (1 - datum.missing_percentage), datum.missing_percentage]",as:"agree_percentage"},{type:"formula",expr:"[1, 0, 0.5]",as:"agree"},{type:"flatten",fields:["agree_percentage","agree"],as:["agree_percentage","agree"]},{type:"stack",groupby:["feature","model_label"],field:"agree_percentage",sort:{field:["agree"],order:["descending"]},as:["y1","y2"],offset:"zero"},{type:"formula",expr:"(datum.x1 + datum.x2)/2",as:"text_x"}]},{name:"concat_1_row_domain",source:"data_4",transform:[{type:"aggregate",groupby:["model_label"]}]}],signals:[{name:"concat_0_child_width",value:200},{name:"concat_0_child_height",value:200},{name:"concat_1_child_width",value:200},{name:"concat_1_child_height",value:200}],layout:{padding:20,bounds:"full",align:"each"},marks:[{type:"group",name:"concat_0_group",layout:{padding:18,offset:{columnTitle:10},columns:{signal:"length(data('concat_0_column_domain'))"},bounds:"full",align:"all"},marks:[{name:"column-title",type:"group",role:"column-title",title:{text:"Features",style:"guide-title",fontSize:15,fontWeight:"normal",offset:10}},{name:"concat_0_row_header",type:"group",role:"row-header",from:{data:"concat_0_row_domain"},sort:{field:'datum["model_label"]',order:"ascending"},title:{text:{signal:"''+parent[\"model_label\"]"},orient:"left",style:"guide-label",frame:"group",baseline:"middle",align:"right",angle:0,fontSize:15,offset:35},encode:{update:{height:{signal:"concat_0_child_height"}}},axes:[{scale:"concat_0_y",orient:"left",grid:!1,title:"Grape Quality",labelOverlap:!0,tickCount:{signal:"ceil(concat_0_child_height/40)"},zindex:1}]},{name:"concat_0_column_header",type:"group",role:"column-header",from:{data:"concat_0_column_domain"},sort:{field:'datum["mean_abs_shap_value"]',order:"descending"},title:{text:{signal:"''+parent[\"feature_label\"]"},style:"guide-label",frame:"group",fontSize:12,offset:12},encode:{update:{width:{signal:"concat_0_child_width"}}}},{name:"concat_0_cell",type:"group",style:"cell",from:{facet:{name:"concat_0_facet",data:"data_1",groupby:["model_label","feature_label"],aggregate:{cross:!1,fields:["mean_abs_shap_value_by_feature_label"],ops:["max"],as:["mean_abs_shap_value_by_feature_label"]}}},sort:{field:['datum["model_label"]','datum["mean_abs_shap_value_by_feature_label"]'],order:["ascending","descending"]},data:[{source:"concat_0_facet",name:"data_0",transform:[{type:"aggregate",groupby:["label","x2","y2"],ops:["mean","mean"],fields:["x1","y1"],as:["mean_x1","mean_y1"]}]}],encode:{update:{width:{signal:"concat_0_child_width"},height:{signal:"concat_0_child_height"}}},marks:[{name:"concat_0_child_layer_0_marks",type:"rect",clip:!0,style:["rect"],from:{data:"data_0"},encode:{update:{opacity:{value:.25},fill:[{test:'datum["mean_x1"] === null || isNaN(datum["mean_x1"]) || datum["mean_y1"] === null || isNaN(datum["mean_y1"])',value:null},{value:"#2ca02c"}],x:[{test:'datum["mean_x1"] === null || isNaN(datum["mean_x1"])',value:0},{scale:"concat_0_child_x",field:"mean_x1"}],x2:[{test:'datum["x2"] === null || isNaN(datum["x2"])',value:0},{scale:"concat_0_child_x",field:"x2"}],y:[{test:'datum["mean_y1"] === null || isNaN(datum["mean_y1"])',field:{group:"height"}},{scale:"concat_0_y",field:"mean_y1"}],y2:[{test:'datum["y2"] === null || isNaN(datum["y2"])',field:{group:"height"}},{scale:"concat_0_y",field:"y2"}]}}},{name:"concat_0_child_layer_1_marks",type:"symbol",style:["circle"],from:{data:"concat_0_facet"},encode:{update:{opacity:{value:.7},fill:[{test:'datum["value"] === null || isNaN(datum["value"]) || datum["expected_value"] === null || isNaN(datum["expected_value"])',value:null},{test:"datum.agree === null",value:"#8a8a8a"},{scale:"color",field:"agree"}],x:[{test:'datum["value"] === null || isNaN(datum["value"])',value:0},{scale:"concat_0_child_x",field:"value"}],y:[{test:'datum["expected_value"] === null || isNaN(datum["expected_value"])',field:{group:"height"}},{scale:"concat_0_y",field:"expected_value"}],shape:{value:"circle"}}}}],scales:[{name:"concat_0_child_x",type:"linear",domain:{fields:[[],{data:"concat_0_facet",field:"value"}]},range:[0,{signal:"concat_0_child_width"}],nice:!0,zero:!1,padding:.5}],axes:[{scale:"concat_0_child_x",orient:"bottom",grid:!1,title:" ",labelFlush:!0,labelOverlap:!0,tickCount:{signal:"ceil(concat_0_child_width/40)"},zindex:1},{scale:"concat_0_child_x",orient:"bottom",gridScale:"concat_0_y",grid:!0,tickCount:{signal:"ceil(concat_0_child_width/40)"},domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:0},{scale:"concat_0_y",orient:"left",gridScale:"concat_0_child_x",grid:!0,tickCount:{signal:"ceil(concat_0_child_height/40)"},domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:0}]}]},{type:"group",name:"concat_1_group",layout:{padding:18,columns:1,bounds:"full",align:"all"},marks:[{name:"concat_1_row_header",type:"group",role:"row-header",from:{data:"concat_1_row_domain"},sort:{field:'datum["model_label"]',order:"ascending"},title:{text:{signal:"''+parent[\"model_label\"]"},orient:"left",style:"guide-label",frame:"group",fontSize:1e-6,offset:10},encode:{update:{height:{signal:"concat_1_child_height"}}},axes:[{scale:"concat_1_y",orient:"left",grid:!1,title:"Agreement",format:"%",labelOverlap:!0,tickCount:{signal:"ceil(concat_1_child_height/40)"},zindex:1}]},{name:"concat_1_cell",type:"group",style:"cell",from:{facet:{name:"concat_1_facet",data:"data_4",groupby:["model_label"]}},sort:{field:['datum["model_label"]'],order:["ascending"]},encode:{update:{width:{signal:"concat_1_child_width"},height:{signal:"concat_1_child_height"}}},marks:[{name:"concat_1_child_layer_0_marks",type:"rect",style:["rect"],from:{data:"concat_1_facet"},encode:{update:{stroke:[{test:'datum["x1"] === null || isNaN(datum["x1"]) || datum["y1"] === null || isNaN(datum["y1"])',value:null},{value:"white"}],strokeWidth:{value:.5},fill:[{test:'datum["x1"] === null || isNaN(datum["x1"]) || datum["y1"] === null || isNaN(datum["y1"])',value:null},{scale:"concat_1_child_color",field:"agree"}],x:{scale:"concat_1_child_x",field:"x1"},x2:{scale:"concat_1_child_x",field:"x2"},y:{scale:"concat_1_y",field:"y1"},y2:{scale:"concat_1_y",field:"y2"}}}},{name:"concat_1_child_layer_1_marks",type:"text",style:["text"],from:{data:"concat_1_facet"},encode:{update:{baseline:{value:"bottom"},dy:{value:-3},fill:[{test:'datum["text_x"] === null || isNaN(datum["text_x"])',value:null},{value:"white"}],x:{scale:"concat_1_child_x",field:"text_x"},y:{field:{group:"height"}},text:{signal:"''+datum[\"feature\"]"},align:{value:"center"}}}}],scales:[{name:"concat_1_child_x",type:"linear",domain:{fields:[[0,1],{data:"concat_1_facet",field:"text_x"}]},range:[0,{signal:"concat_1_child_width"}],nice:!0,zero:!0},{name:"concat_1_child_color",type:"ordinal",domain:[1,0,.5],range:["#1f77b4","#ff7f0e","#8a8a8a"],interpolate:"hcl"}],axes:[{scale:"concat_1_child_x",orient:"bottom",grid:!1,title:"Importance",format:"%",labelFlush:!0,labelOverlap:!0,tickCount:{signal:"ceil(concat_1_child_width/40)"},zindex:1},{scale:"concat_1_child_x",orient:"bottom",gridScale:"concat_1_y",grid:!0,tickCount:{signal:"ceil(concat_1_child_width/40)"},domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:0},{scale:"concat_1_y",orient:"left",gridScale:"concat_1_child_x",grid:!0,tickCount:{signal:"ceil(concat_1_child_height/40)"},domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:0}]}]}],scales:[{name:"color",type:"ordinal",domain:[1,0],range:["#1f77b4","#ff7f0e"],interpolate:"hcl"},{name:"concat_0_y",type:"linear",domain:{fields:[{data:"data_3",field:"mean_y1"},{data:"data_3",field:"y2"},[1,5]]},range:[{signal:"concat_0_child_height"},0],zero:!1,nice:!0},{name:"concat_1_y",type:"linear",domain:{data:"data_4",fields:["y1","y2"]},range:[{signal:"concat_1_child_height"},0],nice:!0,zero:!0}]}},28:function(e,a,t){e.exports=t(67)},33:function(e,a,t){},37:function(e,a){},38:function(e,a){},56:function(e,a,t){},57:function(e,a,t){var n={"./Grape Quality/features_info.csv":58,"./Grape Quality/intervals/knowledge_intervals.csv":59,"./Grape Quality/models_data.csv":60,"./Grape Quality/models_info.csv":61};function l(e){var a=c(e);return t(a)}function c(e){var a=n[e];if(!(a+1)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a}l.keys=function(){return Object.keys(n)},l.resolve=c,e.exports=l,l.id=57},58:function(e,a,t){e.exports=t.p+"static/media/features_info.dae26627.csv"},59:function(e,a,t){e.exports=t.p+"static/media/knowledge_intervals.44562cb2.csv"},60:function(e,a,t){e.exports=t.p+"static/media/models_data.c93eb794.csv"},61:function(e,a,t){e.exports=t.p+"static/media/models_info.115c9efd.csv"},66:function(e,a,t){},67:function(e,a,t){"use strict";t.r(a);var n=t(2),l=t.n(n),c=t(23),o=t.n(c),r=(t(33),t(9)),i=t(4),u=t(5),s=t(27),d=function(e){var a=e.modelData,t=e.intervalData,c=e.featuresInfo,o=e.modelsInfo,r=Object(n.useRef)(),d=Object(n.useState)(null),_=Object(i.a)(d,2),m=_[0],f=_[1];return Object(n.useEffect)(function(){Object(u.a)(r.current,s,{actions:!1}).then(function(e){return f(e.view)}).catch(console.error)},[]),Object(n.useEffect)(function(){if(m){var e=u.b.changeset().remove(u.b.truthy).insert(a),n=u.b.changeset().remove(u.b.truthy).insert(t),l=u.b.changeset().remove(u.b.truthy).insert(c),r=u.b.changeset().remove(u.b.truthy).insert(o);m.change("intervalData",n).change("featuresInfo",l).change("modelsInfo",r).change("modelData",e).resize().run()}},[m,a,t,c]),l.a.createElement("div",{ref:r,id:"vis"})},_=t(3),m=t(15),f=t.n(m),g=t(16),p=t.n(g),h=t(6),b=t.n(h),y=(t(53),t(54),t(55),t(56),t(57).keys().reduce(function(e,a){var t=e;return(a=a.substring(1)).split("/").splice(1).forEach(function(e){t[e]||(t[e]={}),t=t[e]}),t.path=a,e},{})),v=function(e){var a=e.models,t=e.features,c=e.updateSelections,o=e.updateFiles,u=Object(n.useState)(""),s=Object(i.a)(u,2),d=s[0],m=s[1],g=Object(n.useState)(""),v=Object(i.a)(g,2),x=v[0],O=v[1],j=Object(n.useState)(!1),k=Object(i.a)(j,2),w=k[0],E=k[1],N=Object(n.useReducer)(function(e,a){return Object(r.a)({},e,a)},{}),S=Object(i.a)(N,2),I=S[0],z=S[1],D=Object(n.useReducer)(function(e,a){return Object(r.a)({},e,a)},{}),C=Object(i.a)(D,2),F=C[0],L=C[1];Object(n.useEffect)(function(){var e=a.map(function(e){return e.model});z(e.reduce(function(e,a){return e[a]=Object.keys(e).length<2,e},{}))},[a]),Object(n.useEffect)(function(){var e=t.map(function(e){return e.feature});L(e.reduce(function(e,a){return e[a]=!0,e},{}))},[t]),Object(n.useEffect)(function(){c(I,F)},[I,F]),Object(n.useEffect)(function(){O(""),E(""!==d)},[d]),Object(n.useEffect)(function(){if(w){var e="",a=y[d];x&&"**No Intervals**"!==x&&(e="data"+a.intervals[x+".csv"].path),o({intervals:e,models:"data"+a["models_data.csv"].path,features_info:"data"+a["features_info.csv"].path,model_info:"data"+a["models_info.csv"].path})}else o(null)},[x]);var T=[""].concat(Object.keys(y)),G=d?Object.keys(y[d].intervals):[];return G=G.map(function(e){return e.substring(0,e.indexOf(".csv"))}),l.a.createElement("div",null,l.a.createElement(p.a,{label:"Select Project",onChange:function(e){return m(e.target.value)},value:d,options:T}),l.a.createElement(p.a,{disabled:!w,label:"Select Intervals",onChange:function(e){return O(e.target.value)},value:x,options:["","**No Intervals**"].concat(G)}),l.a.createElement(h.ListGroup,null,l.a.createElement(h.ListGroupSubheader,null,"Models"),l.a.createElement(b.a,{twoLine:!0,dense:!0},a.map(function(e){return l.a.createElement(h.ListItem,{key:e.model,onClick:function(a){a.preventDefault(),z(Object(_.a)({},e.model,!I[e.model]))}},l.a.createElement(h.ListItemText,{className:"checkbox",primaryText:e.model_label+" "+e.score,secondaryText:e.model}),l.a.createElement(f.a,{nativeControlId:e.model,checked:I[e.model],onChange:function(){return z(Object(_.a)({},e.model,!I[e.model]))}}))}),l.a.createElement(h.ListDivider,null)),l.a.createElement(h.ListGroupSubheader,null,"Features"),l.a.createElement(b.a,{twoLine:!0,dense:!0},t.map(function(e){return l.a.createElement(h.ListItem,{key:e.feature,onClick:function(a){a.preventDefault(),L(Object(_.a)({},e.feature,!F[e.feature]))}},l.a.createElement(h.ListItemText,{className:"checkbox",primaryText:e.feature_label,secondaryText:e.feature}),l.a.createElement(f.a,{nativeControlId:e.feature,checked:F[e.feature],onChange:function(){return L(Object(_.a)({},e.feature,!F[e.feature]))}}))}),l.a.createElement(h.ListDivider,null))))},x=t(17),O=t.n(x),j=t(18),k=t.n(j),w=(t(64),t(65),t(66),function(){var e=Object(n.useState)(null),a=Object(i.a)(e,2),t=a[0],c=a[1],o=Object(n.useState)([]),s=Object(i.a)(o,2),_=s[0],m=s[1],f=Object(n.useState)([]),g=Object(i.a)(f,2),p=g[0],h=g[1],b=Object(n.useState)([]),y=Object(i.a)(b,2),w=y[0],E=y[1],N=Object(n.useState)([]),S=Object(i.a)(N,2),I=S[0],z=S[1],D=Object(n.useState)([]),C=Object(i.a)(D,2),F=C[0],L=C[1],T=Object(n.useState)([]),G=Object(i.a)(T,2),A=G[0],M=G[1];Object(n.useEffect)(function(){if(t){var e=u.b.loader();Promise.all([e.load(t.models),e.load(t.intervals),e.load(t.features_info),e.load(t.model_info)]).then(function(e){var a=Object(i.a)(e,4),t=a[0],n=a[1],l=a[2],c=a[3],o=u.b.read(c,{type:"csv",parse:"auto"}),s=Object.keys(o[0]).pop("model"),d=o.length.toString().length,_=new Intl.NumberFormat("en-EN",{minimumIntegerDigits:d}),f=new Intl.NumberFormat("en-EN",{maximumFractionDigits:3,minimumFractionDigits:3});o=(o=o.sort(function(e,a){return e[s]-a[s]})).map(function(e,a){return{model:e.model,model_label:"M"+_.format(a),score:"(".concat(s,": ").concat(f.format(e[s]),")")}});var g=u.b.read(n,{type:"csv",parse:"auto"}),p=u.b.read(t,{type:"csv",parse:"auto"});m(p.map(function(e){var a=g.filter(function(a){return a.feature===e.feature}).find(function(a){return+a.x1<=+e.value&&+e.value<=+a.x2}),t=null,n=null;return a&&(t=a.label,n=+(+a.y1<=+e.expected_value&&+e.expected_value<=+a.y2)),Object(r.a)({},e,{label:t,agree:n})})),z(o),h(g),E(u.b.read(l,{type:"csv",parse:"auto"}))}).catch(console.error)}else m([]),h([]),E([]),z([])},[t]);var Q=Object(n.useMemo)(function(){return F.length&&A.length?_.filter(function(e){return F.includes(e.model)&&A.includes(e.feature)}):[]},[F,A]);return l.a.createElement("div",{className:"drawer-container"},l.a.createElement(O.a,{title:"AHMOSE: Augmented by Human Model Selection"}),l.a.createElement(x.TopAppBarFixedAdjust,{className:"top-app-bar-fix-adjust"},l.a.createElement(k.a,{className:"drawer"},l.a.createElement(v,{models:I,features:w,updateSelections:function(e,a){var t=Object.keys(e).filter(function(a){return e[a]}),n=Object.keys(a).filter(function(e){return a[e]});L(t),M(n)},updateFiles:c})),l.a.createElement(j.DrawerAppContent,{className:"drawer-app-content"},Q.length?l.a.createElement(d,{modelData:Q,intervalData:p,featuresInfo:w,modelsInfo:I}):null)))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(l.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[28,1,2]]]);
//# sourceMappingURL=main.67fa07b9.chunk.js.map